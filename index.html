<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dom Music</title>

<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="#ff7a00">

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
  import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBp4HTngTmzi3Kh2ejMSURnU8ctJoTJ1ms",
    authDomain: "dom-music-127a8.firebaseapp.com",
    projectId: "dom-music-127a8",
    storageBucket: "dom-music-127a8.firebasestorage.app",
    messagingSenderId: "412932629110",
    appId: "1:412932629110:web:f6122e06eb77179a3f3557"
  };

  const app = initializeApp(firebaseConfig);
  const auth = getAuth(app);
  const db = getFirestore(app);

  window.registrar = async function() {
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;
    const tipo = document.getElementById("tipo").value;

    try {
      const userCredential = await createUserWithEmailAndPassword(auth, email, senha);
      await setDoc(doc(db, "usuarios", userCredential.user.uid), {
        email: email,
        tipo: tipo
      });
      alert("Conta criada com sucesso!");
    } catch (error) {
      alert(error.message);
    }
  }

  window.login = async function() {
    const email = document.getElementById("email").value;
    const senha = document.getElementById("senha").value;

    try {
      const userCredential = await signInWithEmailAndPassword(auth, email, senha);
      const docSnap = await getDoc(doc(db, "usuarios", userCredential.user.uid));

      if (docSnap.exists()) {
        const dados = docSnap.data();
        if (dados.tipo === "professor") {
          document.getElementById("login").style.display = "none";
          document.getElementById("professor").style.display = "block";
        } else {
          document.getElementById("login").style.display = "none";
          document.getElementById("aluno").style.display = "block";
        }
      }

    } catch (error) {
      alert(error.message);
    }
  }

  window.logout = async function() {
    await signOut(auth);
    location.reload();
  }
</script>

<style>
body{
  margin:0;
  font-family:Arial;
  background:#0f172a;
  color:#fff;
  padding:20px;
}
.card{
  background:#1e293b;
  padding:20px;
  border-radius:15px;
  margin-bottom:20px;
}
input,select{
  width:100%;
  padding:10px;
  margin-bottom:10px;
  border-radius:10px;
  border:none;
}
button{
  width:100%;
  padding:12px;
  background:#ff7a00;
  border:none;
  border-radius:10px;
  color:#fff;
  font-weight:bold;
}
</style>

</head>
<body>

<div id="login" class="card">
  <h2>Dom Music - Login</h2>
  <select id="tipo">
    <option value="aluno">Aluno</option>
    <option value="professor">Professor</option>
  </select>
  <input type="email" id="email" placeholder="Email">
  <input type="password" id="senha" placeholder="Senha">
  <button onclick="login()">Entrar</button>
  <br><br>
  <button onclick="registrar()">Criar Conta</button>
</div>

<div id="professor" class="card" style="display:none">
  <h2>Painel do Professor</h2>
  <p>Login realizado com sucesso.</p>
  <button onclick="logout()">Sair</button>
</div>

<div id="aluno" class="card" style="display:none">
  <h2>Painel do Aluno</h2>
  <p>Login realizado com sucesso.</p>
  <button onclick="logout()">Sair</button>
</div>

</body>
</html>
